<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swimming Tank - Interactive Frog Explorer</title>
    <meta name="description" content="Watch your frog swim through an underwater world of floating file folders using Three.js">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <canvas id="loading-canvas"></canvas>
    </div>

    <!-- Main Container -->
    <div id="container">

        <!-- Crosshair -->
        <div id="crosshair"></div>

        <!-- Selection hint -->
        <div id="selection-hint" class="selection-hint">Press <strong>Enter</strong> to preview</div>
        
        <!-- Controls Display - Bottom Center -->
        <div id="controls-panel">
            <button id="controls-toggle">Controls ▲</button>
            <div id="controls-content">
                <div class="controls-row">
                    <span class="control-key">WASD</span> Move
                    <span class="control-key">↑↓</span> Up/Down
                </div>
                <div class="controls-row">
                    <span class="control-key">R</span> Re-align Camera
                    <span class="control-key">Enter</span> Interact
                </div>
                <div class="controls-row">
                    <span class="control-key">Space</span> Dash
                    <span class="control-key">Esc</span> Close
                </div>
            </div>
        </div>

        <!-- Container for dynamically created preview windows -->
        <div id="preview-container"></div>

        <!-- Lighting Config Panel -->
        <div id="light-panel" class="config-panel hidden">
            <div class="panel-header">
                <h3>Lighting Config</h3>
                <button id="close-light-panel" class="close-btn">&times;</button>
            </div>

            <div class="panel-section">
                <h4>Ambient Light</h4>
                <div class="slider-row">
                    <label>Intensity</label>
                    <input type="range" id="ambient-intensity" min="0" max="3" step="0.1" value="1.2">
                    <span class="value-display" id="ambient-intensity-val">1.2</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="ambient-color" value="#ffffff">
                </div>
            </div>

            <div class="panel-section">
                <h4>Main Directional</h4>
                <div class="slider-row">
                    <label>Intensity</label>
                    <input type="range" id="main-intensity" min="0" max="3" step="0.1" value="1.4">
                    <span class="value-display" id="main-intensity-val">1.4</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="main-color" value="#ffffff">
                </div>
                <div class="slider-row">
                    <label>Pos X</label>
                    <input type="range" id="main-pos-x" min="-30" max="30" step="1" value="10">
                    <span class="value-display" id="main-pos-x-val">10</span>
                </div>
                <div class="slider-row">
                    <label>Pos Y</label>
                    <input type="range" id="main-pos-y" min="0" max="50" step="1" value="20">
                    <span class="value-display" id="main-pos-y-val">20</span>
                </div>
                <div class="slider-row">
                    <label>Pos Z</label>
                    <input type="range" id="main-pos-z" min="-30" max="30" step="1" value="5">
                    <span class="value-display" id="main-pos-z-val">5</span>
                </div>
            </div>

            <div class="panel-section">
                <h4>Underwater Light</h4>
                <div class="slider-row">
                    <label>Intensity</label>
                    <input type="range" id="underwater-intensity" min="0" max="2" step="0.1" value="0.4">
                    <span class="value-display" id="underwater-intensity-val">0.4</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="underwater-color" value="#88ccff">
                </div>
            </div>

            <div class="panel-section">
                <h4>Overhead Light</h4>
                <div class="slider-row">
                    <label>Intensity</label>
                    <input type="range" id="overhead-intensity" min="0" max="2" step="0.1" value="0.8">
                    <span class="value-display" id="overhead-intensity-val">0.8</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="overhead-color" value="#ffffff">
                </div>
            </div>

            <div class="panel-section">
                <h4>Caustic Lights</h4>
                <div class="slider-row">
                    <label>Intensity</label>
                    <input type="range" id="caustic-intensity" min="0" max="2" step="0.1" value="0.6">
                    <span class="value-display" id="caustic-intensity-val">0.6</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="caustic-color" value="#44aaff">
                </div>
            </div>

            <div class="panel-section">
                <h4>Floor</h4>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="floor-color" value="#d4af8c">
                </div>
            </div>

            <div class="panel-section">
                <h4>Decorations</h4>
                <div class="slider-row">
                    <label>Rock Y</label>
                    <input type="range" id="rock-y-offset" min="-10" max="10" step="0.5" value="0.5">
                    <span class="value-display" id="rock-y-offset-val">0.5</span>
                </div>
                <div class="slider-row">
                    <label>Seaweed Y</label>
                    <input type="range" id="seaweed-y-offset" min="-10" max="10" step="0.5" value="0">
                    <span class="value-display" id="seaweed-y-offset-val">0</span>
                </div>
                <div class="slider-row">
                    <label>Starfish Y</label>
                    <input type="range" id="starfish-y-offset" min="-10" max="10" step="0.5" value="0">
                    <span class="value-display" id="starfish-y-offset-val">0</span>
                </div>
            </div>

            <div class="panel-section">
                <h4>PDF Model Rotation</h4>
                <div class="slider-row">
                    <label>Rot X</label>
                    <input type="range" id="pdf-rot-x" min="-180" max="180" step="15" value="90">
                    <span class="value-display" id="pdf-rot-x-val">90</span>
                </div>
                <div class="slider-row">
                    <label>Rot Y</label>
                    <input type="range" id="pdf-rot-y" min="-180" max="180" step="15" value="0">
                    <span class="value-display" id="pdf-rot-y-val">0</span>
                </div>
                <div class="slider-row">
                    <label>Rot Z</label>
                    <input type="range" id="pdf-rot-z" min="-180" max="180" step="15" value="0">
                    <span class="value-display" id="pdf-rot-z-val">0</span>
                </div>
                <p class="panel-note">Rotation in degrees. Refresh to apply to all PDFs.</p>
            </div>

            <div class="panel-section">
                <h4>Tank Dimensions</h4>
                <div class="slider-row">
                    <label>Width</label>
                    <input type="range" id="tank-width" min="10" max="150" step="5" value="30">
                    <span class="value-display" id="tank-width-val">30</span>
                </div>
                <div class="slider-row">
                    <label>Height</label>
                    <input type="range" id="tank-height" min="5" max="100" step="5" value="20">
                    <span class="value-display" id="tank-height-val">20</span>
                </div>
                <div class="slider-row">
                    <label>Floor Y</label>
                    <input type="range" id="tank-floor" min="-150" max="-10" step="5" value="-60">
                    <span class="value-display" id="tank-floor-val">-60</span>
                </div>
                <div class="slider-row">
                    <label>Ceiling</label>
                    <input type="range" id="tank-ceiling" min="5" max="100" step="5" value="15">
                    <span class="value-display" id="tank-ceiling-val">15</span>
                </div>
                <p class="panel-note">Swim bounds update live. Objects need refresh.</p>
            </div>

            <div class="panel-section">
                <h4>Fog</h4>
                <div class="slider-row">
                    <label>Near</label>
                    <input type="range" id="fog-near" min="0" max="50" step="1" value="15">
                    <span class="value-display" id="fog-near-val">15</span>
                </div>
                <div class="slider-row">
                    <label>Far</label>
                    <input type="range" id="fog-far" min="10" max="200" step="5" value="80">
                    <span class="value-display" id="fog-far-val">80</span>
                </div>
                <div class="slider-row">
                    <label>Color</label>
                    <input type="color" id="fog-color" value="#4477aa">
                </div>
            </div>

            <button id="reset-lights" class="reset-btn">Reset to Defaults</button>
        </div>
    </div>

    <!-- Loading animation script -->
    <script>
    (function() {
        const canvas = document.getElementById('loading-canvas');
        const ctx = canvas.getContext('2d');
        let rotation = 0;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        function drawFrog(x, y, size, angle) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);

            // Body
            ctx.fillStyle = '#4a7c59';
            ctx.beginPath();
            ctx.ellipse(0, 0, size * 0.8, size * 0.6, 0, 0, Math.PI * 2);
            ctx.fill();

            // Head
            ctx.fillStyle = '#5a8c69';
            ctx.beginPath();
            ctx.ellipse(0, -size * 0.5, size * 0.5, size * 0.4, 0, 0, Math.PI * 2);
            ctx.fill();

            // Eyes
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(-size * 0.25, -size * 0.65, size * 0.18, 0, Math.PI * 2);
            ctx.arc(size * 0.25, -size * 0.65, size * 0.18, 0, Math.PI * 2);
            ctx.fill();

            // Pupils
            ctx.fillStyle = '#1a1a1a';
            ctx.beginPath();
            ctx.arc(-size * 0.25, -size * 0.65, size * 0.08, 0, Math.PI * 2);
            ctx.arc(size * 0.25, -size * 0.65, size * 0.08, 0, Math.PI * 2);
            ctx.fill();

            // Back legs
            ctx.fillStyle = '#4a7c59';
            ctx.beginPath();
            ctx.ellipse(-size * 0.6, size * 0.3, size * 0.35, size * 0.15, -0.5, 0, Math.PI * 2);
            ctx.ellipse(size * 0.6, size * 0.3, size * 0.35, size * 0.15, 0.5, 0, Math.PI * 2);
            ctx.fill();

            // Front legs
            ctx.beginPath();
            ctx.ellipse(-size * 0.5, -size * 0.1, size * 0.25, size * 0.1, -0.3, 0, Math.PI * 2);
            ctx.ellipse(size * 0.5, -size * 0.1, size * 0.25, size * 0.1, 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function animate() {
            ctx.fillStyle = '#001122';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            rotation += 0.02;
            drawFrog(canvas.width / 2, canvas.height / 2, 60, rotation);

            if (document.getElementById('loading').style.display !== 'none') {
                requestAnimationFrame(animate);
            }
        }
        animate();
    })();
    </script>

    <!-- Import map to resolve "three" package via CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Scripts -->
    <script type="module" src="src/main.js"></script>
</body>
</html>